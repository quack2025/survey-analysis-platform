# Sistema de Exportaci√≥n Detallada

## üéØ Objetivo

Crear m√∫ltiples formatos de exportaci√≥n que permitan an√°lisis estad√≠stico posterior, especialmente:
1. **Datos a nivel de respondente** (cada fila = un encuestado)
2. **Formato Pivot** para SPSS/R/Python (columnas con 0/1)
3. **Sintaxis SPSS** autom√°tica
4. **Mantener IDs de respondentes** para cruzar con otras variables

---

## ‚úÖ Ya Implementado

1. **`lib/utils/export.ts`** - 5 funciones de exportaci√≥n
2. **`components/export/ExportMenu.tsx`** - Men√∫ interactivo de exportaci√≥n

---

## üìä Formatos Disponibles

### Formato 1: Detallado por Respondente
**Archivo**: `pregunta_detailed.csv`

```csv
RespondentID,Question,Answer,Net,Code,Sentiment
001,"¬øPor qu√©...?","porque siempre me a gustado...","Sabor y Caracter√≠sticas √önicas","Preferencia de sabor","Positive"
001,"¬øPor qu√©...?","porque siempre me a gustado...","Conexi√≥n Emocional","Lealtad a la marca","Positive"
002,"¬øPor qu√©...?","Me fascina la lechera","Conexi√≥n Emocional","Lealtad a la marca","Positive"
```

**Uso**: An√°lisis cualitativo profundo, quotes por c√≥digo

---

### Formato 2: Pivot (SPSS/R/Python Ready)
**Archivo**: `pregunta_pivot.csv`

```csv
RespondentID,Answer,Preferencia_sabor,Lealtad_marca,Dulzor,Nostalgia,Textura,Calidad
001,"porque siempre...",1,1,0,0,0,1
002,"Me fascina...",0,1,0,0,0,0
003,"soy fanatica del dulce",0,0,1,0,0,0
```

**Uso**:
- Importar a SPSS y hacer tablas cruzadas
- An√°lisis de correspondencias
- Regresi√≥n log√≠stica
- Clustering

**Ejemplo en SPSS**:
```spss
* Importar CSV
GET DATA
  /TYPE=TXT
  /FILE='pregunta_pivot.csv'
  /DELCASE=LINE
  /DELIMITERS=","
  /ARRANGEMENT=DELIMITED
  /FIRSTCASE=2
  /VARIABLES=
  RespondentID A10
  Answer A255
  Preferencia_sabor F1.0
  Lealtad_marca F1.0
  ...
  .

* Frecuencias
FREQUENCIES VARIABLES=Preferencia_sabor TO Calidad.
```

---

### Formato 3: Resumen Agregado
**Archivo**: `pregunta_summary.csv`

```csv
RespondentID,Answer,Nets,Codes,Sentiments,PositiveCount,NeutralCount,NegativeCount
001,"porque siempre...","Sabor | Conexi√≥n","Preferencia | Lealtad","Positive | Positive",2,0,0
002,"Me fascina","Conexi√≥n","Lealtad","Positive",1,0,0
```

**Uso**: Reportes ejecutivos, dashboards, an√°lisis de sentimiento

---

### Formato 4: Sintaxis SPSS
**Archivo**: `pregunta_spss.sps`

```spss
* SPSS Syntax for: ¬øPor qu√© eligi√≥ esta natilla?
* Generated by Survey Analysis Platform

VARIABLE LABELS
  Q1_1 "Preferencia de sabor"
  Q1_2 "Lealtad a la marca"
  Q1_3 "Dulzor balanceado"
  Q1_4 "Nostalgia infantil"
  Q1_5 "Textura suave"
  Q1_6 "Alta calidad"
  .

VALUE LABELS
  Q1_1 TO Q1_6 0 "No mencionado" 1 "Mencionado"
  .

FREQUENCIES VARIABLES=Q1_1 TO Q1_6.

* Crear variable compuesta de sentimiento
COMPUTE Sentiment_Score = Q1_1 + Q1_2 + Q1_4.
VARIABLE LABELS Sentiment_Score "Total menciones positivas".
```

**Uso**: Copiar y pegar en SPSS despu√©s de importar el CSV Pivot

---

### Formato 5: Simple (Legacy)
**Archivo**: `pregunta_simple.csv`

```csv
Answer,Nets,Codes,Sentiments
"porque siempre...","Sabor | Conexi√≥n","Preferencia | Lealtad","Positive | Positive"
```

**Uso**: Compatibilidad con versi√≥n anterior, Excel simple

---

## üîß C√≥mo Implementar

### Paso 1: Copiar Archivos Creados

Ya cre√©:
- ‚úÖ `lib/utils/export.ts` - Funciones de exportaci√≥n
- ‚úÖ `components/export/ExportMenu.tsx` - UI del men√∫

### Paso 2: Actualizar `app/review/page.tsx`

**Guardar IDs de respondentes** al procesar:

```typescript
// En processAllQuestions(), despu√©s de l√≠nea ~50

// AGREGAR: Extraer IDs de respondentes
const respondentIds: string[] = [];
surveyData.questions.forEach(q => {
  q.answers.forEach(a => {
    if (!respondentIds.includes(a.respondentId)) {
      respondentIds.push(a.respondentId);
    }
  });
});

// MODIFICAR: Al guardar results
results.respondentIds = respondentIds;  // ‚Üê AGREGAR ESTO
results.questions.push({
  text: question.text,
  type: questionType,
  nets: netsData.nets,
  classifiedAnswers: classifyAnswersData.classifiedAnswers,
  respondentIds: question.answers.map(a => a.respondentId), // ‚Üê AGREGAR ESTO
});
```

### Paso 3: Actualizar `app/results/page.tsx`

Reemplazar el bot√≥n de exportaci√≥n actual con el nuevo men√∫:

```typescript
// Importar componente
import ExportMenu from '@/components/export/ExportMenu';

// Reemplazar el bot√≥n "Export Results" (l√≠nea ~28) con:
<ExportMenu
  classifiedAnswers={currentQuestion.classifiedAnswers || []}
  nets={currentQuestion.nets || []}
  questionText={currentQuestion.text}
  respondentIds={currentQuestion.respondentIds || []}
/>
```

### Paso 4: Actualizar Interface de AnalysisResults

```typescript
// En app/results/page.tsx (l√≠nea ~8-17)
interface AnalysisResults {
  projectConfig: any;
  respondentIds?: string[];  // ‚Üê AGREGAR
  questions: Array<{
    text: string;
    type: 'REFERENCE' | 'OPINION';
    nets?: any[];
    classifiedAnswers?: any[];
    answers?: string[];
    respondentIds?: string[];  // ‚Üê AGREGAR
  }>;
}
```

---

## üìà Ejemplo de An√°lisis Completo

### Workflow Recomendado

1. **Exportar 3 archivos**:
   - `natilla_pivot.csv` (datos)
   - `natilla_spss.sps` (sintaxis)
   - `natilla_detailed.csv` (verbatims)

2. **En SPSS**:
```spss
* 1. Importar datos pivot
GET DATA /TYPE=TXT /FILE='natilla_pivot.csv' ...

* 2. Ejecutar sintaxis generada
INCLUDE 'natilla_spss.sps'.

* 3. An√°lisis de frecuencias
FREQUENCIES VARIABLES=ALL.

* 4. Tabla cruzada por edad (si tienes variable demogr√°fica)
CROSSTABS
  /TABLES=Edad BY Preferencia_sabor Nostalgia Dulzor
  /CELLS=COUNT COLUMN.

* 5. An√°lisis de correspondencias
CORRESPONDENCE TABLE=Preferencia_sabor TO Calidad
  /DIMENSIONS=2
  /PLOT=NDIM(1,2).
```

3. **Para quotes** (en Excel):
   - Abrir `natilla_detailed.csv`
   - Filtrar por `Code = "Nostalgia infantil"`
   - Copiar columna `Answer` para informe

---

## üéØ Casos de Uso

### Caso 1: An√°lisis de Drivers
**Objetivo**: ¬øQu√© c√≥digos predicen intenci√≥n de compra?

```r
# En R
library(readr)
library(dplyr)

data <- read_csv("natilla_pivot.csv")

# Regresi√≥n log√≠stica
model <- glm(Comprar√≠a ~
             Preferencia_sabor +
             Nostalgia +
             Dulzor +
             Calidad,
             data = data,
             family = binomial)

summary(model)
```

---

### Caso 2: Segmentaci√≥n
**Objetivo**: ¬øHay grupos de consumidores con patrones distintos?

```python
# En Python
import pandas as pd
from sklearn.cluster import KMeans

data = pd.read_csv("natilla_pivot.csv")
features = data.iloc[:, 2:]  # Todas las columnas de c√≥digos

kmeans = KMeans(n_clusters=3)
data['Segment'] = kmeans.fit_predict(features)

# Ver qu√© c√≥digos caracterizan cada segmento
data.groupby('Segment').mean()
```

---

### Caso 3: Reportes con Quotes
**Objetivo**: Informe con % y ejemplos de verbatims

```
Insight #1: Nostalgia infantil (18% de menciones)
"ese sabor de la lechera es el unico es lo mejor y me traslada
a la epoca de mi infancia" - Resp 010

"me traslada a mi ni√±es cuando convivia de ni√±o con mis abuelos" - Resp 041
```

*Proceso*:
1. Ver % en archivo Summary
2. Buscar quotes en archivo Detailed

---

## üöÄ Mejoras Futuras

### Pr√≥ximas Features
1. **Exportar a Excel multi-hoja** (resumen + detalle + c√≥digos)
2. **Generaci√≥n de PowerPoint** autom√°tica
3. **API para integraci√≥n** con herramientas BI
4. **Dashboard interactivo** (D3.js/Chart.js)

### Integraciones Posibles
- Tableau/Power BI (v√≠a CSV Pivot)
- Qualtrics (import codes back)
- Confirmit (export to coding scheme)
- MaxQDA/NVivo (qualitative analysis)

---

## üìã Checklist de Implementaci√≥n

- [x] Copiar `lib/utils/export.ts`
- [x] Copiar `components/export/ExportMenu.tsx`
- [x] Actualizar `app/review/page.tsx` (guardar respondentIds)
- [x] Actualizar `app/results/page.tsx` (usar ExportMenu)
- [x] Actualizar interface AnalysisResults
- [ ] Probar con tu archivo Excel
- [ ] Verificar los 5 formatos de exportaci√≥n
- [ ] Probar importar Pivot en SPSS
- [ ] Ejecutar sintaxis SPSS generada
- [ ] Validar que IDs de respondentes coinciden

---

## ‚úÖ Resultado Esperado

Despu√©s de analizar tu archivo Excel con 45 respuestas:

**Archivos generados:**
```
natilla_lechera_detailed.csv     (135 filas = 45 resp √ó 3 c√≥digos promedio)
natilla_lechera_pivot.csv        (45 filas √ó 15 columnas de c√≥digos)
natilla_lechera_summary.csv      (45 filas con conteo de sentimientos)
natilla_lechera_spss.sps         (sintaxis SPSS lista para usar)
natilla_lechera_simple.csv       (45 filas formato b√°sico)
```

**An√°lisis posible:**
- ‚úÖ Cruzar c√≥digos con variables demogr√°ficas
- ‚úÖ Identificar perfiles de consumidores
- ‚úÖ Predecir intenci√≥n de compra
- ‚úÖ Generar reportes con quotes
- ‚úÖ An√°lisis estad√≠stico robusto

---

## üéâ Estado de Implementaci√≥n

‚úÖ **IMPLEMENTADO COMPLETAMENTE**

Todos los cambios de c√≥digo est√°n completos:

1. ‚úÖ **lib/utils/export.ts** - 5 funciones de exportaci√≥n listas
2. ‚úÖ **components/export/ExportMenu.tsx** - Men√∫ interactivo de exportaci√≥n
3. ‚úÖ **app/review/page.tsx** - Captura y guarda respondent IDs
4. ‚úÖ **app/results/page.tsx** - Usa ExportMenu en lugar del bot√≥n simple
5. ‚úÖ **Interface actualizada** - AnalysisResults incluye respondentIds

### Pr√≥ximos Pasos para el Usuario

1. **Reiniciar el servidor de desarrollo**:
   ```bash
   cd survey-analysis-platform
   npm run dev
   ```

2. **Procesar tu archivo Excel** con las 45 respuestas de Natilla

3. **En la p√°gina de resultados**, hacer clic en el bot√≥n "Export Results" y seleccionar uno de los 5 formatos:
   - **Formato Detallado**: Para an√°lisis cualitativo con verbatims
   - **Formato Pivot**: Para importar a SPSS/R/Python
   - **Resumen Agregado**: Para reportes ejecutivos
   - **Sintaxis SPSS**: Para copiar y pegar en SPSS
   - **Simple (Legacy)**: Para compatibilidad con versi√≥n anterior

4. **Para an√°lisis en SPSS**:
   - Exportar archivo Pivot
   - Exportar Sintaxis SPSS
   - Importar CSV en SPSS
   - Ejecutar sintaxis generada
   - Realizar an√°lisis estad√≠stico (frecuencias, crosstabs, regresi√≥n, etc.)

### Nota Importante

Los archivos exportados incluir√°n el RespondentID en cada fila, permitiendo:
- Cruzar con variables demogr√°ficas de tu base de datos original
- An√°lisis segmentado por edad, g√©nero, regi√≥n, etc.
- Modelos predictivos (regresi√≥n, clustering)
- Reportes con quotes espec√≠ficos por segmento
